<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>quvi.rb by avsej</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="author" content="Sergey Avseyev"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"/>
    <link rel="me" type="text/html" href="http://www.google.com/profiles/sergey.avseyev" />
    <style type="text/css">
      body { font-family: "Droid Sans", Verdana, Arial, Helvetica, sans-serif; }
    </style>
  </head>
  <body>
    <h1>quvi.rb</h1>
    <p>Quvi is a wrapper for <a href="http://quvi.sf.net">libquvi</a>, the library to parse the media stream properties.</p>

    <h2>Installation</h2>
    <p>Follow installation instruction <a href="http://quvi.sf.net/r/howto/install/">on quvi site</a> or just install <code>libquvi-devel</code> if you are Fedora user.</p>
    <pre><code>$ sudo yum install libquvi-devel</code></pre>
    <p>Add this line to your application's Gemfile:</p>
    <pre><code>gem 'quvi'</code></pre>
    <p>And then execute:</p>
    <pre><code>$ bundle</code></pre>
    <p>Or install it yourself as:</p>
    <pre><code>$ gem install quvi</code></pre>

    <h2>Usage</h2>

    <p>Create an handle which basically encapsulates HTTP session</p>

<pre><code>handle = Quvi::Handle.new(user_agent: "Chrome/33.0.1712.4")
</code></pre>

<p>Pass an media URL to <code>Quvi::Handle#parse_media</code> method (note how it tags the best available stream)</p>

<pre><code>handle.parse_media("https://www.youtube.com/watch?v=9PLY4TWo7f0")
# {:id=&gt;"9PLY4TWo7f0",
#  :title=&gt;"Big Ruby 2014 - Keynote by Keavy McMinn",
#  :thumbnail_url=&gt;"https://i1.ytimg.com/vi/9PLY4TWo7f0/default.jpg",
#  :duration_ms=&gt;1627000,
#  :streams=&gt;
#   [{:id=&gt;"hd720_mp4_i22_720p", :best=&gt;true, :video_height=&gt;720, :video_width=&gt;1280, :video_encoding=&gt;"avc1.64001F", :audio_encoding=&gt;"mp4a.40.2", :container=&gt;"mp4", :url=&gt; "http://..."},
#    {:id=&gt;"medium_mp4_i18_360p", :video_height=&gt;360, :video_width=&gt;640, :video_encoding=&gt;"avc1.42001E", :audio_encoding=&gt;"mp4a.40.2", :container=&gt;"mp4", :url=&gt; "http://..."},
#    {:id=&gt;"small_flv_i05_240p", :video_height=&gt;240, :video_width=&gt;320, :video_encoding=&gt;"", :audio_encoding=&gt;"", :container=&gt;"flv", :url=&gt; "http://..."},
#    {:id=&gt;"small_3gpp_i36_240p", :video_height=&gt;240, :video_width=&gt;320, :video_encoding=&gt;"mp4v.20.3", :audio_encoding=&gt;"mp4a.40.2", :container=&gt;"3gpp", :url=&gt; "http://..."},
#    {:id=&gt;"small_3gpp_i17_144p", :video_height=&gt;144, :video_width=&gt;176, :video_encoding=&gt;"mp4v.20.3", :audio_encoding=&gt;"mp4a.40.2", :container=&gt;"3gpp", :url=&gt; "http://..."}]}
</code></pre>

<p>It can parse playlists too with <code>Quvi::Handle#parse_playlist</code></p>

<pre><code>handle.parse_playlist("https://www.youtube.com/playlist?list=PLE7tQUdRKcyYqVZi0LIbAsfwv_Jr-rrua")
# {:id=&gt;"PLE7tQUdRKcyYqVZi0LIbAsfwv_Jr-rrua",
#  :title=&gt;"Cascadia Ruby 2013",
#  :thumbnail_url=&gt;"https://i.ytimg.com/vi/MkoTmq3I4DM/hqdefault.jpg",
#  :media=&gt;
#   [{:url=&gt;"https://www.youtube.com/watch?v=MkoTmq3I4DM&amp;feature=youtube_gdata", :title=&gt; "Cascadia Ruby 2013 Coding and The Mozart Effect by PJ Hagerty", :duration_ms=&gt;1775000},
#    {:url=&gt;"https://www.youtube.com/watch?v=0y2Sok9ikj8&amp;feature=youtube_gdata", :title=&gt; "Cascadia Ruby 2013 Taking Ruby to the Movies by Jeremy Hinegardner", :duration_ms=&gt;1776000},
#    {:url=&gt;"https://www.youtube.com/watch?v=euDXpKwtCHY&amp;feature=youtube_gdata", :title=&gt; "Cascadia Ruby 2013 Tell Us Another Story Grandpa: Lessons Learned over 16 Years as a Developer", :duration_ms=&gt;1643000},
#    {:url=&gt;"https://www.youtube.com/watch?v=FsBgpvDnUSk&amp;feature=youtube_gdata", :title=&gt; "Cascadia Ruby 2013 Ruby Robotics by Josh Adams and Robby Clements", :duration_ms=&gt;1378000},
#    {:url=&gt;"https://www.youtube.com/watch?v=rpeugzat2o4&amp;feature=youtube_gdata", :title=&gt; "Cascadia Ruby 2013 We All Make Mistakes: Learning from Gaffes in the Ruby Community by Nick Cox", :duration_ms=&gt;1868000},
#    {:url=&gt;"https://www.youtube.com/watch?v=g4LJNZKyqOw&amp;feature=youtube_gdata", :title=&gt; "Cascadia Ruby 2013 We're sorry, but something went wrong by Aja Hammerly", :duration_ms=&gt;1909000},
#    {:url=&gt;"https://www.youtube.com/watch?v=x9Kazz5-tDo&amp;feature=youtube_gdata", :title=&gt; "Cascadia Ruby 2013 The hacker's guide to usability testing by Starr Horne", :duration_ms=&gt;1487000},
#    {:url=&gt;"https://www.youtube.com/watch?v=iSug6CgxWxc&amp;feature=youtube_gdata", :title=&gt; "Cascadia Ruby 2013 Sentiment Analysis using Support Vector Machines in Ruby by Matthew Kirk", :duration_ms=&gt;1518000}]}
</code></pre>

<p>Youtube isn&rsquo;t the only site it supports. You can fine full list of them in the <a href="https://github.com/legatvs/libquvi-scripts">repository</a> or write your own using guides on the <a href="http://quvi.sourceforge.net/r/dev/contributing/">libquvi-scripts site</a>. Also it is quite easy to enumerate all accessible scripts from the ruby:</p>

<pre><code>handle.each_script do |script|
  p script
end
# {:sha1=&gt;"cc2d07c64cb329d9d14209ce464030a2eb152dc6", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/scan/youtube.lua", :type=&gt;"scan"}
# {:sha1=&gt;"e145e40e56f27805278ae6a36352bab3225d4d77", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/scan/vzaar.lua", :type=&gt;"scan"}
# {:sha1=&gt;"a6e55279aaee3bbe6b372fc55b8a6f7751e34ace", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/playlist/youtube.lua", :type=&gt;"playlist", :domains=&gt;["youtube.com"]}
# {:sha1=&gt;"ddc1d5aaa691131d3ef30cf1b9b482d38cacee51", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/playlist/soundcloud.lua", :type=&gt;"playlist", :domains=&gt;["soundcloud.com"]}
# {:sha1=&gt;"32e0ead26b603ee10f1deba49e2352d14edd4d67", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/audioboo.lua", :type=&gt;"media", :domains=&gt;["audioboo.fm"]}
# {:sha1=&gt;"a0879b74362cfba9dcaebc3ffe16d034368ed60c", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/liveleak.lua", :type=&gt;"media", :domains=&gt;["liveleak.com"]}
# {:sha1=&gt;"a1427a3a019877eafa5f5f5960d086c609ab8d1f", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/bikeradar.lua", :type=&gt;"media", :domains=&gt;["bikeradar.com"]}
# {:sha1=&gt;"7fd0a857cf904d1547c119444e2ce29297accec1", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/sapo.lua", :type=&gt;"media", :domains=&gt;["videos.sapo.pt"]}
# {:sha1=&gt;"b935fbe2881e0869028741f630fb7471413aeffe", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/sevenload.lua", :type=&gt;"media", :domains=&gt;["sevenload.com"]}
# {:sha1=&gt;"60a7e893e8aa5f71ed1cc5e4a4fb4f89992f85e5", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/ina.lua", :type=&gt;"media", :domains=&gt;["ina.fr"]}
# {:sha1=&gt;"452aa94dc655090d6c30929335bf5ad73d29e92f", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/metacafe.lua", :type=&gt;"media", :domains=&gt;["metacafe.com"]}
# {:sha1=&gt;"2db42ea01ff5700210e814806712c4892a61bda0", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/dailymotion.lua", :type=&gt;"media", :domains=&gt;["dailymotion.com"]}
# {:sha1=&gt;"cfed259fa8f679ca5ac49f6d34144128df716939", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/ardmediathek.lua", :type=&gt;"media", :domains=&gt;["ardmediathek.de"]}
# {:sha1=&gt;"e1ba6e629a11518c3548c69f3723118a7ac1062d", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/clipfish.lua", :type=&gt;"media", :domains=&gt;["clipfish.de"]}
# {:sha1=&gt;"1853a56b0bd5a18d47f967e875b55c6aa3a7dbb7", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/101greatgoals.lua", :type=&gt;"media", :domains=&gt;["101greatgoals.com"]}
# {:sha1=&gt;"363c01107cd71f360c3f8723ecef7bfba2ab3d73", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/gaskrank.lua", :type=&gt;"media", :domains=&gt;["gaskrank.tv"]}
# {:sha1=&gt;"911433da47662580548e93f0529babcce0863853", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/theonion.lua", :type=&gt;"media", :domains=&gt;["theonion.com"]}
# {:sha1=&gt;"0ae3b44c7b01ae3c7e2e7f4a16cd0dcec79f567a", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/youtube.lua", :type=&gt;"media", :domains=&gt;["youtube.com"]}
# {:sha1=&gt;"69974caa7b3fcdb74b6bd791a6edb610b3dfe4ee", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/majestyc.lua", :type=&gt;"media", :domains=&gt;["tube.majestyc.net"]}
# {:sha1=&gt;"a785a669d1bd2c1c253b64fb1f20937e26ef3609", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/videobash.lua", :type=&gt;"media", :domains=&gt;["videobash.com"]}
# {:sha1=&gt;"c3c0e34cb0191570be0ba4cd1499fd2afa44f165", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/vzaar.lua", :type=&gt;"media", :domains=&gt;["vzaar.com"]}
# {:sha1=&gt;"74a632c1a25807b5b094a1c90d614ec865af482d", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/spiegel.lua", :type=&gt;"media", :domains=&gt;["spiegel.de"]}
# {:sha1=&gt;"3720f0611d54ccd665d13603896de9aa903f72f0", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/videa.lua", :type=&gt;"media", :domains=&gt;["videa.hu"]}
# {:sha1=&gt;"d9268d6b51da1bb23932e79c5bb4a1a15c3588c4", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/ted.lua", :type=&gt;"media", :domains=&gt;["ted.com"]}
# {:sha1=&gt;"7aebe106d954b9317f5f7b4a365dacc50933610a", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/soundcloud.lua", :type=&gt;"media", :domains=&gt;["soundcloud.com"]}
# {:sha1=&gt;"a88735d1e0cc3d61ce45af300008ad97f49b85d3", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/tvlux.lua", :type=&gt;"media", :domains=&gt;["tvlux.be"]}
# {:sha1=&gt;"419af1632ffd971505f61bc8d04945a271bb45d6", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/1tvru.lua", :type=&gt;"media", :domains=&gt;["1tv.ru"]}
# {:sha1=&gt;"d3a8db790e9f4e2b55bd0cf88543d8d38e873d4a", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/arte.lua", :type=&gt;"media", :domains=&gt;["arte.tv"]}
# {:sha1=&gt;"73bcf38c7cb2927a0b8adf29a7b750bc4b21a733", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/funnyordie.lua", :type=&gt;"media", :domains=&gt;["funnyordie.com"]}
# {:sha1=&gt;"c027be9b93e362e451ad54adef2d14c6d4e458af", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/tapuz.lua", :type=&gt;"media", :domains=&gt;["flix.tapuz.co.il"]}
# {:sha1=&gt;"3505d6777a8e03ea3bcf01cf113e2c8c9eeec1fd", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/cbsnews.lua", :type=&gt;"media", :domains=&gt;["cbsnews.com"]}
# {:sha1=&gt;"780399daec55e457c766cde986b35884c79a2e52", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/guardian.lua", :type=&gt;"media", :domains=&gt;["theguardian.com", "guardian.co.uk"]}
# {:sha1=&gt;"a82c60a96067232b3b8cdcd864e16e9509fe947d", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/tagtele.lua", :type=&gt;"media", :domains=&gt;["tagtele.com"]}
# {:sha1=&gt;"1d353ae17cf6d7df597fefbfd81cf8c85e282b7d", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/publicsenat.lua", :type=&gt;"media", :domains=&gt;["publicsenat.fr"]}
# {:sha1=&gt;"46000b58b080b4cb8500634087d19ea54dadab63", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/lego.lua", :type=&gt;"media", :domains=&gt;["lego.com"]}
# {:sha1=&gt;"69ee55e3e10c73700c06695055363a6f8a064e5d", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/senat.lua", :type=&gt;"media", :domains=&gt;["videos.senat.fr"]}
# {:sha1=&gt;"c286f739d77da6e1245ab415be7016cf5fad7e0b", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/media/myspass.lua", :type=&gt;"media", :domains=&gt;["myspass.de"]}
# {:sha1=&gt;"ea16f366f98582d0d52af56cbd3dbe847930dfc3", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/subtitle/youtube.lua", :type=&gt;"subtitle", :domains=&gt;["youtube.com"]}
# {:sha1=&gt;"7411739ec618bbf3486d98cc0fd64962cfee1239", :filepath=&gt;"/usr/share/libquvi-scripts/0.9/subtitle/export/subrip.lua", :type=&gt;"subtitle_export", :export_format=&gt;"srt"}
</code></pre>

<p>To check if particular URL supported by the library, you can use
<code>Quvi::Handle#supports?</code> like this:</p>

<pre><code>require 'quvi'
handle = Quvi::Handle.new
handle.supports?("https://soundcloud.com/meta-ex/burning-the-moroder-lamp")
# =&gt; false
handle.supports?("https://soundcloud.com/meta-ex/burning-the-moroder-lamp", online: true)
# =&gt; true
handle.supports?("https://www.youtube.com/watch?v=S6-L4xws9l0", type: :playlist)
# =&gt; false
handle.supports?("https://www.youtube.com/watch?v=S6-L4xws9l0", type: :media)
# =&gt; true
handle.supports?("https://www.youtube.com/watch?v=S6-L4xws9l0", type: :any)
# =&gt; true
</code></pre>

<p>There are also couple of handy methods defined on <code>Quvi</code> module, to
simplify argument parsing. First <code>Quvi.parse_multiple</code> accepts array
of URLs, dynamically detects type and parse each of them using simple
thread pool. As far as most of the Quvi work is IO, ruby VM can
perfectly optimize it.</p>

<h2>Issues</h2>

<p>Please use <a href="https://github.com/avsej/quvi.rb/issues">github issues</a> to
report any bugs or ideas. Also do not forget to include the version of
the library into report:</p>

<pre><code>$ ruby -rpp -rrubygems -rquvi -e'pp Quvi::VERSION.to_h'
{:version=&gt;"0.1.0",
 :quvi_version=&gt;"v0.9.2",
 :quvi_configuration=&gt; "--build=x86_64-redhat-linux-gnu --host=x86_64-redhat-linux-gnu --program-prefix= --disable-dependency-tracking --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share --includedir=/usr/include --libdir=/usr/lib64 --libexecdir=/usr/libexec --localstatedir=/var --sharedstatedir=/var/lib --mandir=/usr/share/man --infodir=/usr/share/info --enable-static=no --disable-rpath",
 :quvi_build_cc_cflags=&gt; "gcc, -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic",
 :quvi_build_target=&gt;"x86_64-redhat-linux-gnu",
 :quvi_build_time=&gt;"2013-08-27 04:11:40 +0000"}
</code></pre>

    <h2>Contributing</h2>
    <ol>
      <li>Fork it (<a href="http://github.com/avsej/quvi.rb/fork">http://github.com/avsej/quvi.rb/fork</a>)</li>
      <li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
      <li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
      <li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
      <li>Create new Pull Request</li>
    </ol>
    <p>This project is maintained by <a href="https://github.com/avsej">avsej</a></p>

    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
        try {
          var pageTracker = _gat._getTracker("UA-18113495-5");
          pageTracker._trackPageview();
        } catch(err) {}
    </script>
  </body>
</html>
